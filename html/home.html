<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/styles.css">

    <title>Home</title>

</head>

<body>

    <nav class="navbar">
        <a href="/html/home.html" class="navbar-brand">Library Online</a>
        <ul class="navbar-nav">
            <li class="nav-item"><a href="/html/home.html" class="nav-link">HOME</a></li>
            <li class="nav-item"><a href="#destaques" class="nav-link">DESTAQUES</a></li>
            <li class="nav-item"><a href="/html/autores.html" class="nav-link">AUTORES</a></li>
            <li class="nav-item"><a href="/html/index.html" class="nav-link">SAIR</a></li>
        </ul>
    </nav>

    <main class="conteudo">
        <h1 class="titulo-home">HOME</h1>

        <section class="sessao">
            <h2>RESERVADOS</h2>
            <div class="grade-reservados">
                <div class="livro">
                    <img src="/img/livros/Os miseráveis.jpg" alt="Os miseráveis">
                    <button class="btn-reservado">Reservado</button>
                    <button class="btn-devolver">Devolver</button>
                </div>

                <div class="livro">
                    <img src="/img/livros/Dom Casmurro.jpg" alt="Dom Casmurro">
                    <button class="btn-reservado">Reservado</button>
                    <button class="btn-devolver">Devolver</button>
                </div>

                <div class="livro">
                    <img src="/img/livros/A hora da estrela.jpg" alt="A hora da estrela">
                    <button class="btn-reservado">Reservado</button>
                    <button class="btn-devolver">Devolver</button>
                </div>

            </div>
        </section>

        <section id="destaques" class="sessao">
            <h2>DESTAQUES</h2>
            <div class="grade">

                <div class="livro">
                    <img src="/img/livros/O sol é para todos.jpg" alt="O sol é para todos">
                    <button class="btn-reservar">Reservar</button>
                    <button class="btn-disponiveis">disponiveis: 2</button>
                </div>

                <div class="livro">
                    <img src="/img/livros/O morro dos ventos uivantes.jpg" alt="O morro dos ventos uivantes">
                    <button class="btn-reservar">Reservar</button>
                    <button class="btn-disponiveis">disponiveis: 2</button>
                </div>

                <div class="livro">
                    <img src="/img/livros/Os irmãos Karamázov.jpg" alt="Os irmãos Karamázov">
                    <button class="btn-reservar">Reservar</button>
                    <button class="btn-disponiveis">disponiveis: 2</button>
                </div>

                <div class="livro">
                    <img src="/img/livros/Dracula.jpg" alt="Dracula">
                    <button class="btn-reservar">Reservar</button>
                    <button class="btn-disponiveis">disponiveis: 2</button>
                </div>

                <div class="livro">
                    <img src="/img/livros/Crime e Castigo.jpg" alt="Crime e Castigo">
                    <button class="btn-reservar">Reservar</button>
                    <button class="btn-disponiveis">disponiveis: 2</button>
                </div>

            </div>
        </section>

        <script>

            //Lógica contador de livros disponíveis
            //Aqui consta para quando ele devolver o livro incrementar novamente
            document.addEventListener("click", function (event) {

                const botao = event.target;

                function capturaQuantidadeAtual(button) {
                    let texto = button.textContent;
                    let partes = texto.split(":");
                    let quantidadeAtual = parseInt(partes[1]);
                    return quantidadeAtual;
                }

                function incrementar(button, quantidadeAtual) {
                    const quantidade = quantidadeAtual + 1;
                    return button.textContent = `DISPONIVEIS: ${quantidade}`;
                }

                //

                if (botao.textContent == "Devolver") {

                    const livro = botao.closest(".livro");

                    if (!livro) return;

                    const button = livro.querySelector(".btn-disponiveis");

                    if (!button) return;

                    const atual = capturaQuantidadeAtual(button);

                    if (typeof atual === "number" && !isNaN(atual)) {
                        incrementar(button, atual);
                    }

                    setTimeout(function () {
                        button.style.display = "block";
                    }, 900);

                }

            });


            //Aqui fica a logica que permite a decrementacao da quantidade de livros
            document.addEventListener("click", function (event) {

                const botao = event.target;

                function capturaQuantidadeAtual(button) {
                    let texto = button.textContent;
                    let partes = texto.split(":");
                    let quantidadeAtual = parseInt(partes[1]);
                    return quantidadeAtual;
                }

                function decrementar(button, quantidadeAtual) {
                    const quantidade = quantidadeAtual - 1;

                    if (quantidade <= 0) {
                        return button.textContent = "NÃO HÁ LIVROS";
                    }

                    return button.textContent = `DISPONIVEIS: ${quantidade}`;
                }

                //

                if (botao.textContent == "Reservar") {

                    const livro = botao.closest(".livro");

                    if (!livro) return;

                    const button = livro.querySelector(".btn-disponiveis");

                    if (!button) return;

                    const atual = capturaQuantidadeAtual(button);

                    if (typeof atual === "number" && !isNaN(atual)) {
                        decrementar(button, atual);
                    }

                    setTimeout(function () {
                        button.style.display = "none";
                    }, 900);

                }

            });

        </script>

        <script>

            //Lógica para (Reservar)
            document.addEventListener("click", function (event) {

                function enviarLivro(livro, destino) {
                    setTimeout(function () {
                        destino.appendChild(livro);
                    }, 900);
                }

                function criarBotao() {
                    let botaoDevolver = document.createElement("button");
                    botaoDevolver.textContent = "Devolver";
                    botaoDevolver.classList.add("btn-devolver");
                    return botaoDevolver
                }

                function adicionarBotao(botao, destino) {
                    setTimeout(function () {
                        destino.appendChild(botao)
                    }, 900)
                }

                function trocaClasse(elemento, antiga, nova, texto) {
                    elemento.classList.remove(antiga);
                    elemento.classList.add(nova);
                    elemento.textContent = texto;
                }

                const botao = event.target;

                if (botao.textContent === "Reservar") {
                    trocaClasse(botao, "btn-reservar", "btn-reservado", "Reservado");

                    const livro = botao.closest(".livro");
                    const destino = document.querySelector('.grade-reservados');

                    enviarLivro(livro, destino);

                    const botaoDevolver = criarBotao()
                    adicionarBotao(botaoDevolver, livro);

                }

            });

        </script>

        <script>

            //Lógica para devolver
            document.addEventListener("click", function (event) {

                const botao = event.target;

                function trocaClasse(elemento, antiga, nova, texto) {
                    elemento.classList.remove(antiga);
                    elemento.classList.add(nova);
                    elemento.textContent = texto;
                }

                function enviarLivro(botao, livro, destino, texto) {
                    setTimeout(function () {
                        //envio o livro para grade
                        destino.appendChild(livro);

                        //Troca de classe 
                        const btnReservado = livro.querySelector(".btn-reservado");
                        if (btnReservado) {
                            trocaClasse(btnReservado, "btn-reservado", "btn-reservar", "Reservar");
                        };

                        //Oculto o botão 
                        botao.classList.add("btn-ocultar");

                    }, 900);
                    botao.textContent = texto;
                }

                //
                function criarBotaoDisponiveis() {
                    let botaoDisponiveis = document.createElement("button");
                    botaoDisponiveis.textContent = "Disponiveis: 2";
                    botaoDisponiveis.classList.add("btn-disponiveis");

                    return botaoDisponiveis
                }

                function enviarBotaoDisponiveis(botao, livro) {
                    setTimeout(function () {
                        //envio o botao para o livro
                        livro.appendChild(botao);

                    }, 900);
                }

                if (botao.classList.contains("btn-devolver")) {
                    if (botao.textContent === "Devolver") {

                        //Lógica para enviar
                        const livro = botao.closest(".livro");
                        const destino = document.querySelector(".grade");

                        enviarLivro(botao, livro, destino, "Devolvido");


                        //Linha adicional para mostrar na tela o botao disponiveis de volta
                        //closest sobe

                        const button = livro.querySelector(".btn-disponiveis");

                        if (!button) {
                            let botaoDisponiveis = criarBotaoDisponiveis();
                            enviarBotaoDisponiveis(botaoDisponiveis, livro);
                        }

                        setTimeout(function () {
                            button.style.display = "block";
                        }, 900);

                    }
                }
            });

        </script>

</html>